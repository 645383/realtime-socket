<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>

<script type='text/javascript'>

    window.realtime.messageQueue2 = [];
    window.realtime.messageQueue3 = [];

    if (window.realtime.enabled){

        window.realtime.eventBus2 = _.extend({}, Backbone.Events);
        window.realtime.eventBus3 = _.extend({}, Backbone.Events);

        messageQueueRunner = function() {
            message = window.realtime.messageQueue2.shift();
            if (message) {
                window.realtime.eventBus2.trigger('realtimeMessage', message);
            }

            message = window.realtime.messageQueue3.shift();
            if (message) {
                window.realtime.eventBus3.trigger('realtimeMessage', message);
            }
        };

        setInterval(messageQueueRunner, 100);
    }

</script>